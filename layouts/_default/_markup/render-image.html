{{$url := urls.Parse .Destination}}
{{$altText := .Text}}
{{$caption := .Title}}
{{if findRE "^https?" $url.Scheme}}
	<figure>
		<img class="mx-auto my-0 rounded-md" src="{{$url.String}}" alt="{{$altText}}">
		{{with $caption}}
			<figcaption class="text-center">
				{{. | markdownify}}
			</figcaption>
		{{end}}
	</figure>
{{else}}
	{{$resource := ""}}
	{{if $.Page.Resources.GetMatch ($url.String)}}
		{{$resource = $.Page.Resources.GetMatch ($url.String)}}
	{{else if resources.GetMatch ($url.String)}}
		{{$resource = resources.Get ($url.String)}}
	{{end}}
	{{with $resource}}
		<figure>
			<img class="mx-auto my-0 rounded-md"
				{{if or (eq .MediaType.SubType `svg`) (eq .MediaType.SubType `gif`)}}
					src="{{.RelPermalink}}"
				{{else}}
					srcset="{{if ge .Width 330}}
						{{- (.Resize `330x`).RelPermalink}} 330w,
					{{- end}}
					{{- if ge .Width 660}}
						{{- (.Resize `660x`).RelPermalink}} 660w,
					{{- end}}
					{{- if ge .Width 1024}}
						{{- (.Resize `1024x`).RelPermalink}} 1024w,
					{{- end}}
					{{- if ge .Width 1320}}
						{{- (.Resize `1320x`).RelPermalink}} 2x
					{{- end}}"
					src="{{if ge .Width 660}}
						{{- (.Resize `660x`).RelPermalink}}
					{{- else}}
						{{- .RelPermalink}}
					{{- end}}"
				{{end}}
			alt="{{$altText}}">
			{{with $caption}}
				<figcaption class="text-center">
					{{. | markdownify}}
				</figcaption>
			{{end}}
		</figure>
	{{else}}
		<figure>
			<img class="mx-auto my-0 rounded-md" src="{{$url.String}}" alt="{{$altText}}">
			{{with $caption}}
				<figcaption class="text-center">
					{{. | markdownify}}
				</figcaption>
			{{end}}
		</figure>
	{{end}}
{{end}}
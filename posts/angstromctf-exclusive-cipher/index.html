<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>ångstromCTF Exclusive Cipher</title><meta name=description content="My attempt at the XOR cipher question from the 2021 ångstromCTF"><meta name=keywords content="cryptography,python"><meta property="og:url" content="https://applegamer22.github.io/posts/angstromctf-exclusive-cipher/"><meta property="og:type" content="website"><meta property="og:title" content="ångstromCTF Exclusive Cipher"><meta property="og:description" content="My attempt at the XOR cipher question from the 2021 ångstromCTF"><meta property="og:image" content="/favicon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="ångstromCTF Exclusive Cipher"><meta name=twitter:description content="My attempt at the XOR cipher question from the 2021 ångstromCTF"><meta property="twitter:domain" content="https://applegamer22.github.io/posts/angstromctf-exclusive-cipher/"><meta property="twitter:url" content="https://applegamer22.github.io/posts/angstromctf-exclusive-cipher/"><meta name=twitter:image content="/favicon.png"><link rel=canonical href=https://applegamer22.github.io/posts/angstromctf-exclusive-cipher/><link rel=stylesheet type=text/css href=https://applegamer22.github.io/css/normalize.min.css media=print onload='this.media="all"'><link rel=stylesheet type=text/css href=https://applegamer22.github.io/css/main.css><link disabled id=dark-theme rel=stylesheet href=https://applegamer22.github.io/css/dark.css><script src=https://applegamer22.github.io/js/svg-injector.min.js></script>
<script src=https://applegamer22.github.io/js/feather-icons.min.js></script>
<script src=https://applegamer22.github.io/js/main.js></script><meta name=author content="Omri Bornstein"><meta name=og:site_name content="Omri Bornstein's Blog"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.16/dist/katex.min.css integrity=sha384-6LkG2wmY8FK9E0vU9OOr8UvLwsaqUg9SETfpq4uTCN1agNe8HRdE9ABlk+fVx6gZ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.16/dist/katex.min.js integrity=sha384-31El76TwmbHj4rF9DyLsygbq6xoIobG0W+jqXim+a3dU9W53tdH3A/ngRPxOzzaB crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.16/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://applegamer22.github.io><img src=https://applegamer22.github.io/favicon.png alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://applegamer22.github.io>Omri Bornstein</a></div><div class=nav-links><div class=nav-link><a href=https://applegamer22.github.io/>Home</a></div><div class=nav-link><a href=https://applegamer22.github.io/posts/>Posts</a></div><div class=nav-link><a href=https://applegamer22.github.io/tags/>Tags</a></div><div class=nav-link><a href=https://applegamer22.github.io/projects/>Projects</a></div><div class=nav-link><a href=https://github.com/AppleGamer22><span data-feather=github></span></a></div><div class=nav-link><a href=https://www.linkedin.com/in/omri-bornstein/><span data-feather=linkedin></span></a></div><div class=nav-link><a href=https://applegamer22.github.io/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://applegamer22.github.io/>Home</a></li><li class=nav-item><a href=https://applegamer22.github.io/posts/>Posts</a></li><li class=nav-item><a href=https://applegamer22.github.io/tags/>Tags</a></li><li class=nav-item><a href=https://applegamer22.github.io/projects/>Projects</a></li><li class=nav-item><a href=https://github.com/AppleGamer22><span data-feather=github></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/omri-bornstein/><span data-feather=linkedin></span></a></li><li class=nav-item><a href=https://applegamer22.github.io/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>ångstromCTF Exclusive Cipher</h1><small role=doc-subtitle>My attempt at the XOR cipher question from the 2021 ångstromCTF</small><p class=post-date>May 31, 2021</p><ul class=post-tags><li class=post-tag><a href=https://applegamer22.github.io/tags/cryptography>cryptography</a></li><li class=post-tag><a href=https://applegamer22.github.io/tags/python>python</a></li></ul></div><div class=post-content><p><h1 id=prompt>Prompt</h1><blockquote><p>Clam decided to return to classic cryptography and revisit the XOR cipher! Here&rsquo;s some hex encoded cipher text:</p><pre tabindex=0><code>ae27eb3a148c3cf031079921ea3315cd27eb7d02882bf724169921eb3a469920e07d0b883bf63c018869a5090e8868e331078a68ec2e468c2bf13b1d9a20ea0208882de12e398c2df60211852deb021f823dda35079b2dda25099f35ab7d2182&gt; 27e17d0a982bee7d098368f13503cd27f135039f68e62f1f9d3cea7c
</code></pre><p>The key is 5 bytes long, and the flag is somewhere in the message.</p></blockquote><h1 id=analysis>Analysis</h1><p>Assuming 2 hexadecimal digits are equivalent to 1 ASCII characters, a possible key can be found by XORing the ciphertext with the known 5-bytes long substring <code>actf{</code>.</p><h1 id=solution>Solution</h1><p>In an XOR Cipher, it is known that <code>possible_key = ciphertext ^ known_cleartext</code>. The python script attached:</p><ol><li>slices the ciphertext to all possible 5 characters-long (assuming 2 hexadecimal digits are equivalent to 1 ASCII characters) sections,</li><li>computes <code>possible_key = ciphertext ^ known_cleartext</code>, for a known substring of <code>actf{</code>,</li><li>expands the key to the ASCII length of the message,</li><li>rotates the key to deal with cases where the known clear text is not in an index that is a multiple of the key length.<ul><li>Thanks to <a href=https://hashnode.com/@Levon>@Levon</a> for this suggestion.</li></ul></li><li>recomputes the XOR to possibly decode the message</li><li>and prints the possible message as ASCII.</li></ol><h2 id=initial-python-code>Initial Python Code</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> List
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> doctest <span style=color:#f92672>import</span> testmod
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> textwrap <span style=color:#f92672>import</span> wrap
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>xor</span>(s: List[int], t: List[int]) <span style=color:#f92672>-&gt;</span> List[int]:
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	:param s: list of non-negative integers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	:param t: list of non-negative integers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	:return: XOR of the ith number of both lists
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> [a <span style=color:#f92672>^</span> b <span style=color:#66d9ef>for</span> a, b <span style=color:#f92672>in</span> zip(s, t)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>expand_key</span>(short_key: List[int], size: int) <span style=color:#f92672>-&gt;</span> List[int]:
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	:param short_key: list of non-negative integers
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	:param size: positive integer
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	:return: short_key * (size // len(short_key)) + short_key[:size - len(key_expanded)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&gt;&gt;&gt; expand_key([1, 2, 3, 4, 5], 9)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	[1, 2, 3, 4, 5, 1, 2, 3, 4]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>assert</span> size <span style=color:#f92672>&gt;</span> len(short_key)
</span></span><span style=display:flex><span>	key_expanded <span style=color:#f92672>=</span> short_key <span style=color:#f92672>*</span> (size <span style=color:#f92672>//</span> len(short_key))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> ii <span style=color:#f92672>in</span> range(size <span style=color:#f92672>-</span> len(key_expanded)):
</span></span><span style=display:flex><span>		key_expanded<span style=color:#f92672>.</span>append(short_key[ii])
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> key_expanded
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ciphertext_text <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;hex-encoded ciphertext: &#34;</span>)
</span></span><span style=display:flex><span>known_cleartext <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;known cleartext (with length of key): &#34;</span>)
</span></span><span style=display:flex><span>hint <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;hint (such as &#39;flag&#39;): &#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cipher_ascii <span style=color:#f92672>=</span> [int(letter, <span style=color:#ae81ff>16</span>) <span style=color:#66d9ef>for</span> letter <span style=color:#f92672>in</span> wrap(ciphertext_text, <span style=color:#ae81ff>2</span>)]
</span></span><span style=display:flex><span>known_cleartext_ascii <span style=color:#f92672>=</span> [ord(letter) <span style=color:#66d9ef>for</span> letter <span style=color:#f92672>in</span> known_cleartext]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(cipher_ascii) <span style=color:#f92672>-</span> len(known_cleartext)):
</span></span><span style=display:flex><span>	key <span style=color:#f92672>=</span> xor(cipher_ascii[i:i <span style=color:#f92672>+</span> len(known_cleartext)], known_cleartext_ascii)
</span></span><span style=display:flex><span>	expanded_key <span style=color:#f92672>=</span> expand_key(key, len(cipher_ascii))
</span></span><span style=display:flex><span>	message_ascii <span style=color:#f92672>=</span> xor(cipher_ascii, expanded_key)
</span></span><span style=display:flex><span>	message_text <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join(map(chr, message_ascii))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> known_cleartext <span style=color:#f92672>in</span> message_text <span style=color:#f92672>and</span> hint <span style=color:#f92672>in</span> message_text:
</span></span><span style=display:flex><span>		print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;key: </span><span style=color:#e6db74>{</span>key<span style=color:#e6db74>}</span><span style=color:#e6db74> (&#39;</span><span style=color:#e6db74>{</span><span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(map(chr, key))<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;)&#34;</span>)
</span></span><span style=display:flex><span>		print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;message: </span><span style=color:#e6db74>{</span>message_text<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>		print()
</span></span></code></pre></div><h2 id=improved-python-code>Improved Python Code</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> typing <span style=color:#f92672>import</span> TypedDict, List
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> textwrap <span style=color:#f92672>import</span> wrap
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> xor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>XORSolution</span>(TypedDict):
</span></span><span style=display:flex><span>	key: List[int]
</span></span><span style=display:flex><span>	cleartext: str
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode_xor</span>(ciphertext_hex: str, known_cleartext: str, hint: str) <span style=color:#f92672>-&gt;</span> List[XORSolution]:
</span></span><span style=display:flex><span>	output <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>	cipher_ascii <span style=color:#f92672>=</span> bytes(int(letter, <span style=color:#ae81ff>16</span>) <span style=color:#66d9ef>for</span> letter <span style=color:#f92672>in</span> wrap(ciphertext_hex, <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(cipher_ascii)):
</span></span><span style=display:flex><span>		key <span style=color:#f92672>=</span> list(xor(cipher_ascii[i:i <span style=color:#f92672>+</span> len(known_cleartext)], known_cleartext<span style=color:#f92672>.</span>encode()))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> ii <span style=color:#f92672>in</span> range(len(key)):
</span></span><span style=display:flex><span>			rotated_key <span style=color:#f92672>=</span> key[<span style=color:#f92672>-</span>ii:] <span style=color:#f92672>+</span> key[:<span style=color:#f92672>-</span>ii]
</span></span><span style=display:flex><span>			cleartext <span style=color:#f92672>=</span> str(xor(cipher_ascii, rotated_key))[<span style=color:#ae81ff>2</span>:<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> known_cleartext <span style=color:#f92672>in</span> cleartext <span style=color:#f92672>and</span> hint <span style=color:#f92672>in</span> cleartext:
</span></span><span style=display:flex><span>				output<span style=color:#f92672>.</span>append({<span style=color:#e6db74>&#34;key&#34;</span>: rotated_key, <span style=color:#e6db74>&#34;cleartext&#34;</span>: cleartext})
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> output
</span></span></code></pre></div><h2 id=python-script-output>Python Script Output</h2><ul><li>A Python script that prints all valid solutions for the full ciphertext and the ciphertext without the first character:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>ciphertext_hex1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ae27eb3a148c3cf031079921ea3315cd27eb7d02882bf724169921eb3a469920e07d0b883bf63c018869a5090e8868e331078a68ec2e468c2bf13b1d9a20ea0208882de12e398c2df60211852deb021f823dda35079b2dda25099f35ab7d218227e17d0a982bee7d098368f13503cd27f135039f68e62f1f9d3cea7c&#34;</span>
</span></span><span style=display:flex><span>known_cleartext1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;actf{&#34;</span>
</span></span><span style=display:flex><span>hint1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;flag&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> solution <span style=color:#f92672>in</span> decode_xor(ciphertext_hex1, known_cleartext1, hint1):
</span></span><span style=display:flex><span>	print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;key: </span><span style=color:#e6db74>{</span>solution[<span style=color:#e6db74>&#39;key&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>)
</span></span><span style=display:flex><span>	print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;message: </span><span style=color:#e6db74>{</span>solution[<span style=color:#e6db74>&#39;cleartext&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> solution <span style=color:#f92672>in</span> decode_xor(ciphertext_hex1[<span style=color:#ae81ff>2</span>:], known_cleartext1, hint1):
</span></span><span style=display:flex><span>	print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;key: </span><span style=color:#e6db74>{</span>solution[<span style=color:#e6db74>&#39;key&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>)&#34;</span>)
</span></span><span style=display:flex><span>	print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;message: </span><span style=color:#e6db74>{</span>solution[<span style=color:#e6db74>&#39;cleartext&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span></code></pre></div><ul><li>The output of the screen described immediately above:</li></ul><pre tabindex=0><code>key: [237, 72, 133, 93, 102])
message: Congratulations on decrypting the message! The flag is actf{who_needs_aes_when_you_have_xor}. Good luck on the other crypto!
key: [72, 133, 93, 102, 237])
message: ongratulations on decrypting the message! The flag is actf{who_needs_aes_when_you_have_xor}. Good luck on the other crypto!
</code></pre><p><strong>Flag</strong>: <code>actf{who_needs_aes_when_you_have_xor}</code></p><h1 id=references>References</h1><ul><li>Szymański, Ł. (2021). ångstromCTF 2021: Exclusive Cipher. szymanski.ninja. <a href=https://szymanski.ninja/en/ctfwriteups/2021/angstromctf/exclusive-cipher/>https://szymanski.ninja/en/ctfwriteups/2021/angstromctf/exclusive-cipher/</a></li></ul></p></div></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><a href=#prompt>Prompt</a></li><li><a href=#analysis>Analysis</a></li><li><a href=#solution>Solution</a><ul><li><a href=#initial-python-code>Initial Python Code</a></li><li><a href=#improved-python-code>Improved Python Code</a></li><li><a href=#python-script-output>Python Script Output</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2022</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>